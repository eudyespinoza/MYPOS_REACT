# MYPOS_REACT

Point of Sale (POS) platform with a React frontend and a Python backend powered by FastAPI. All operational data is sourced from Parquet files generated by background jobs outside of this repository.

## Setup

### Backend (FastAPI)

```bash
cd app
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -r requirements.txt
uvicorn backend_app.main:app --reload --port 8000
```

The backend expects cached datasets under `SERVICES_CACHE_DIR` (defaults to `/srv/data/cache` on Linux or `C:\cache` on Windows). Update the path if your environment stores the Parquet files elsewhere.

### Environment Variables

Create an `.env` file (see `app/src/.env.example`) and provide the credentials required by your integrations:

- `SERVICES_CACHE_DIR`, `EMP_PARQUET_PATH`, etc. for Parquet caches.
- `USERNAME_FABRIC`, `PASSWORD_FABRIC`, `PASSWORD_DB` for data sources.
- `GRAPH_CLIENT_SECRET`, `D365_CLIENT_SECRET_QA`, `D365_CLIENT_SECRET_PROD` for external services.
- `VITE_BACKEND_URL` consumed by the frontend Vite dev server.

## Project Structure

### Backend (`app/`)

```
app/
  Dockerfile           # Imagen base para FastAPI
  entrypoint.sh        # Script de arranque usado en contenedores
  requirements.txt     # Dependencias del backend para entornos locales/Docker
  src/
    backend_app/
      main.py          # Punto de entrada de FastAPI (incluye routers y middlewares)
      services/        # Adaptadores HTTP expuestos por el backend (ej. parquet_service)
    services/          # Capa de dominio: integraciones D365, caché, correo, impuestos, etc.
    config.py          # Configuración compartida (variables de entorno, rutas de datos)
```

El backend se organiza en dos niveles: `backend_app` contiene la aplicación FastAPI mínima y
sus routers, mientras que `services/` concentra la lógica de negocio reutilizable y las
integraciones externas (fabric, D365, correo, caching). Esto facilita probar los servicios de
forma aislada y evita acoplarlos al framework web.

### Frontend (`frontend/`)

```
frontend/
  public/              # Assets estáticos servidos tal cual (favicon, imágenes)
  src/
    api/               # Clientes fetch + normalización de respuestas del backend
    components/        # Componentes UI (TopBar, modales, paneles)
    hooks/             # Hooks reutilizables (hotkeys, barcode, sincronización remota)
    pages/             # Páginas de la SPA (POS principal)
    stores/            # Zustand stores (carrito, filtros, sesión, toasts)
    types/             # Tipos/DTO compartidos
    utils/             # Helpers (cálculos, impresión, formato)
  vite.config.ts       # Configuración de Vite + proxies
  tailwind.config.js   # Tema y plugins de Tailwind CSS
```

El frontend es una aplicación Vite + React 18 con TypeScript. El módulo raíz (`src/pages/POS.tsx`)
monta la pantalla única del POS reutilizando componentes desacoplados y stores centralizados.

### Infraestructura

- `traefik/`: Reverse proxy configuration for local/production deployments.

## Docker Compose

`docker-compose.yml` defines three services:

- `traefik`: optional reverse proxy used in production-like setups.
- `api`: FastAPI service served by `uvicorn`.
- `frontend`: Vite development server pointing to the API.

## Security

Never commit real credentials to the repository. Use environment variables or secret managers for runtime configuration.
